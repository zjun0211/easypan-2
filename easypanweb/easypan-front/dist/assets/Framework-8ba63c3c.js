import{j as G,r as m,ag as v,o as l,c as p,a as t,F as j,V as n,P as d,T as E,a3 as Y,U as z,n as Z,a8 as H,O as B,S as N,J as T,K as X,u as O,bh as ee,bf as te,w as ie,R as ue}from"./@vue-7298a6f3.js";import{u as K,b as Q}from"./vue-router-3dc4a115.js";import{S as ce}from"./spark-md5-66a43a5d.js";import{_ as se}from"./index-23b7f611.js";import"./aplayer-585df14e.js";import"./element-plus-746218ca.js";import"./lodash-es-36eb724a.js";import"./@vueuse-896144d5.js";import"./@element-plus-925c7e21.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-9f3e7f81.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-9626137c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-0225a2a3.js";import"./vue-cookies-fc2d14d9.js";import"./@highlightjs-600d0386.js";import"./highlight.js-6845818c.js";import"./axios-4a70c6fc.js";import"./docx-preview-8cc7001d.js";import"./jszip-1f4bc9a3.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-4bdf9d28.js";import"./vue-d7dd0a62.js";import"./dplayer-d4a41b2a.js";import"./vue-clipboard3-69020072.js";import"./clipboard-0f4a3daa.js";const de={class:"avatar-upload"},pe={class:"avatar-show"},_e=["src"],me=["src"],ve=["src"],fe={class:"select-btn"},he={__name:"AvatarUpload",props:{modelValue:{type:Object,default:null}},setup(w,{emit:g}){G(),K(),Q(),m("");const x=m(null),P=async c=>{c=c.file;let e=new FileReader;e.readAsDataURL(c),e.onload=({target:y})=>{x.value=y.result},g("update:modelValue",c)};return(c,e)=>{const y=v("el-button"),D=v("el-upload");return l(),p("div",de,[t("div",pe,[x.value?(l(),p("img",{key:0,src:x.value},null,8,_e)):(l(),p(j,{key:1},[w.modelValue&&w.modelValue.qqAvatar?(l(),p("img",{key:0,src:`${w.modelValue.qqAvatar}`},null,8,me)):(l(),p("img",{key:1,src:`/api/getAvatar/${w.modelValue.userId}`},null,8,ve))],64))]),t("div",fe,[n(D,{name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.bmp,.BMP",multiple:!1,"http-request":P},{default:d(()=>[n(y,{type:"primary"},{default:d(()=>[E("选择")]),_:1})]),_:1})])])}}},we={__name:"UpdateAvatar",emits:["updateAvatar"],setup(w,{expose:g,emit:x}){const{proxy:P}=G();K(),Q();const c={updateUserAvatar:"updateUserAvatar"},e=m({}),y=m();g({show:U=>{e.value=Object.assign({},U),e.value.avatar={userId:U.userId,qqAvatar:U.avatar},R.value.show=!0}});const R=m({show:!1,title:"修改头像",buttons:[{type:"primary",text:"确定",click:U=>{V()}}]}),V=async()=>{if(!(e.value.avatar instanceof File)){R.value.show=!1;return}if(!await P.Request({url:c.updateUserAvatar,params:{avatar:e.value.avatar}}))return;R.value.show=!1;const r=P.VueCookies.get("userInfo");delete r.avatar,P.VueCookies.set("userInfo",r,0),x("updateAvatar")};return(U,r)=>{const _=v("el-form-item"),f=v("el-form"),F=v("Dialog");return l(),p("div",null,[n(F,{show:R.value.show,title:R.value.title,buttons:R.value.buttons,width:"500px",showCancel:!0,onClose:r[2]||(r[2]=o=>R.value.show=!1)},{default:d(()=>[n(f,{model:e.value,ref_key:"formDataRef",ref:y,"label-width":"80px",onSubmit:r[1]||(r[1]=Y(()=>{},["prevent"]))},{default:d(()=>[n(_,{label:"昵称",prop:""},{default:d(()=>[E(z(e.value.nickName),1)]),_:1}),n(_,{label:"头像",prop:""},{default:d(()=>[n(he,{modelValue:e.value.avatar,"onUpdate:modelValue":r[0]||(r[0]=o=>e.value.avatar=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},ge=t("span",{class:"iconfont icon-password"},null,-1),ye=t("span",{class:"iconfont icon-password"},null,-1),ke={__name:"UpdatePassword",setup(w,{expose:g}){const{proxy:x}=G(),P={updatePassword:"updatePassword"},c=m({}),e=m(),y=(r,_,f)=>{_!==c.value.rePassword?f(new Error(r.message)):f()},D={password:[{required:!0,message:"请输入密码"},{validator:x.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],rePassword:[{required:!0,message:"请再次输入密码"},{validator:y,message:"两次输入的密码不一致"}]};g({show:()=>{V.value.show=!0,Z(()=>{e.value.resetFields(),c.value={}})}});const V=m({show:!1,title:"修改密码",buttons:[{type:"primary",text:"确定",click:r=>{U()}}]}),U=async()=>{e.value.validate(async r=>{!r||!await x.Request({url:P.updatePassword,params:{password:c.value.password}})||(V.value.show=!1,x.Message.success("密码修改成功"))})};return(r,_)=>{const f=v("el-input"),F=v("el-form-item"),o=v("el-form"),i=v("Dialog");return l(),p("div",null,[n(i,{show:V.value.show,title:V.value.title,buttons:V.value.buttons,width:"500px",showCancel:!0,onClose:_[3]||(_[3]=a=>V.value.show=!1)},{default:d(()=>[n(o,{model:c.value,rules:D,ref_key:"formDataRef",ref:e,"label-width":"80px",onSubmit:_[2]||(_[2]=Y(()=>{},["prevent"]))},{default:d(()=>[n(F,{label:"新密码",prop:"password"},{default:d(()=>[n(f,{type:"password",size:"large",placeholder:"请输入密码",modelValue:c.value.password,"onUpdate:modelValue":_[0]||(_[0]=a=>c.value.password=a),"show-password":""},{prefix:d(()=>[ge]),_:1},8,["modelValue"])]),_:1}),n(F,{label:"确认密码",prop:"rePassword"},{default:d(()=>[n(f,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:c.value.rePassword,"onUpdate:modelValue":_[1]||(_[1]=a=>c.value.rePassword=a),"show-password":""},{prefix:d(()=>[ye]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};const be=w=>(ee("data-v-86c924bd"),w=w(),te(),w),Ce={class:"uploader-panel"},Se=be(()=>t("div",{class:"uploader-title"},[t("span",null,"上传任务"),t("span",{class:"tips"},"（仅展示本次上传任务）")],-1)),$e={class:"file-list"},xe={class:"file-item"},Pe={class:"upload-panel"},Ue={class:"file-name"},Fe={class:"progress"},Ie={class:"upload-status"},Re={key:0,class:"upload-info"},Ve={class:"op"},Ae={class:"op-btn"},ze={key:0},De={key:0},q=1024*1024*5,Ne={__name:"Uploader",emits:["uploadCallback"],setup(w,{expose:g,emit:x}){const{proxy:P}=G(),c={upload:"/file/uploadFile"},e={emptyfile:{value:"emptyfile",desc:"文件为空",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"上传失败",color:"#F75000",icon:"close"},init:{value:"init",desc:"解析中",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"上传中",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"上传完成",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"秒传",color:"#67c23a",icon:"ok"}},y=m([]),D=m([]);g({addFile:async(o,i)=>{const a={file:o,uid:o.uid,md5Progress:0,md5:null,fileName:o.name,status:e.init.value,uploadSize:0,totalSize:o.size,uploadProgress:0,pause:!1,chunkIndex:0,filePid:i,errorMsg:null};if(y.value.unshift(a),a.totalSize==0){a.status=e.emptyfile.value;return}let b=await f(a);b!=null&&_(b)}});const V=o=>{let i=F(o);i.pause=!1,_(o,i.chunkIndex)},U=o=>{let i=F(o);i.pause=!0},r=(o,i)=>{D.value.push(o),y.value.splice(i,1)},_=async(o,i)=>{i=i||0;let a=F(o);const b=a.file,C=a.totalSize,s=Math.ceil(C/q);for(let S=i;S<s;S++){let A=D.value.indexOf(o);if(A!=-1){D.value.splice(A,1);break}if(a=F(o),a.pause)break;let h=S*q,M=h+q>=C?C:h+q,u=b.slice(h,M),$=await P.Request({url:c.upload,showLoading:!1,dataType:"file",params:{file:u,fileName:b.name,fileMd5:a.md5,chunkIndex:S,chunks:s,fileId:a.fileId,filePid:a.filePid},showError:!1,errorCallback:I=>{a.status=e.fail.value,a.errorMsg=I},uploadProgressCallback:I=>{let L=I.loaded;L>C&&(L=C),a.uploadSize=S*q+L,a.uploadProgress=Math.floor(a.uploadSize/C*100)}});if($==null)break;if(a.fileId=$.data.fileId,a.status=e[$.data.status].value,a.chunkIndex=S,$.data.status==e.upload_seconds.value||$.data.status==e.upload_finish.value){a.uploadProgress=100,x("uploadCallback");break}}},f=o=>{let i=o.file,a=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,b=Math.ceil(i.size/q),C=0,s=new ce.ArrayBuffer,S=new FileReader;new Date().getTime();let A=()=>{let h=C*q,M=h+q>=i.size?i.size:h+q;S.readAsArrayBuffer(a.call(i,h,M))};return A(),new Promise((h,M)=>{let u=F(i.uid);S.onload=$=>{if(s.append($.target.result),C++,C<b){let I=Math.floor(C/b*100);u.md5Progress=I,A()}else{let I=s.end();s.destroy(),u.md5Progress=100,u.status=e.uploading.value,u.md5=I,h(o.uid)}},S.onerror=()=>{u.md5Progress=-1,u.status=e.fail.value,h(o.uid)}}).catch(h=>null)},F=o=>y.value.find(a=>a.file.uid===o);return(o,i)=>{const a=v("el-progress"),b=v("icon"),C=v("NoData");return l(),p("div",Ce,[Se,t("div",$e,[(l(!0),p(j,null,H(y.value,(s,S)=>(l(),p("div",xe,[t("div",Pe,[t("div",Ue,z(s.fileName),1),t("div",Fe,[s.status==e.uploading.value||s.status==e.upload_seconds.value||s.status==e.upload_finish.value?(l(),B(a,{key:0,percentage:s.uploadProgress},null,8,["percentage"])):N("",!0)]),t("div",Ie,[t("span",{class:T(["iconfont","icon-"+e[s.status].icon]),style:X({color:e[s.status].color})},null,6),t("span",{class:"status",style:X({color:e[s.status].color})},z(s.status=="fail"?s.errorMsg:e[s.status].desc),5),s.status==e.uploading.value?(l(),p("span",Re,z(O(P).Utils.size2Str(s.uploadSize))+"/"+z(O(P).Utils.size2Str(s.totalSize)),1)):N("",!0)])]),t("div",Ve,[s.status==e.init.value?(l(),B(a,{key:0,type:"circle",width:50,percentage:s.md5Progress},null,8,["percentage"])):N("",!0),t("div",Ae,[s.status===e.uploading.value?(l(),p("span",ze,[s.pause?(l(),B(b,{key:0,width:28,class:"btn-item",iconName:"upload",title:"上传",onClick:A=>V(s.uid)},null,8,["onClick"])):(l(),B(b,{key:1,width:28,class:"btn-item",iconName:"pause",title:"暂停",onClick:A=>U(s.uid)},null,8,["onClick"]))])):N("",!0),s.status!=e.init.value&&s.status!=e.upload_finish.value&&s.status!=e.upload_seconds.value?(l(),B(b,{key:1,width:28,class:"del btn-item",iconName:"del",title:"删除",onClick:A=>r(s.uid,S)},null,8,["onClick"])):N("",!0),s.status==e.upload_finish.value||s.status==e.upload_seconds.value?(l(),B(b,{key:2,width:28,class:"clean btn-item",iconName:"clean",title:"清除",onClick:A=>r(s.uid,S)},null,8,["onClick"])):N("",!0)])])]))),256)),y.value.length==0?(l(),p("div",De,[n(C,{msg:"暂无上传任务"})])):N("",!0)])])}}},Me=se(Ne,[["__scopeId","data-v-86c924bd"]]);const W=w=>(ee("data-v-4d6c57b6"),w=w(),te(),w),qe={class:"framework"},Le={class:"header"},Be=W(()=>t("div",{class:"logo"},[t("span",{class:"iconfont icon-pan"}),t("span",{class:"name"},"报雪云盘")],-1)),Te={class:"right-panel"},je=W(()=>t("span",{class:"iconfont icon-transfer"},null,-1)),Ee={class:"user-info"},Ge={class:"avatar"},Oe={class:"nick-name"},Je={class:"body"},He={class:"left-sider"},Ke={class:"menu-list"},Qe=["onClick"],We={class:"text"},Xe={class:"menu-sub-list"},Ye=["onClick"],Ze={class:"text"},et={key:0,class:"tips"},tt={class:"space-info"},st=W(()=>t("div",null,"空间使用",-1)),at={class:"percent"},ot={class:"space-use"},lt={class:"use"},nt={class:"body-content"},rt={__name:"Framework",setup(w){const{proxy:g}=G(),x=K(),P=Q(),c={getUseSpace:"/getUseSpace",logout:"/logout"},e=m(!1),y=m(),D=u=>{const{file:$,filePid:I}=u;e.value=!0,y.value.addFile($,I)},R=m(),V=()=>{Z(()=>{R.value.reload(),M()})},U=m(0),r=m(g.VueCookies.get("userInfo")),_=[{icon:"cloude",name:"首页",menuCode:"main",path:"/main/all",allShow:!0,children:[{icon:"all",name:"全部",category:"all",path:"/main/all"},{icon:"video",name:"视频",category:"video",path:"/main/video"},{icon:"music",name:"音频",category:"music",path:"/main/music"},{icon:"image",name:"图片",category:"image",path:"/main/image"},{icon:"doc",name:"文档",category:"doc",path:"/main/doc"},{icon:"more",name:"其他",category:"others",path:"/main/others"}]},{path:"/myshare",icon:"share",name:"分享",menuCode:"share",allShow:!0,children:[{name:"分享记录",path:"/myshare"}]},{path:"/recycle",icon:"del",name:"回收站",menuCode:"recycle",tips:"回收站为你保存10天内删除的文件",allShow:!0,children:[{name:"删除的文件",path:"/recycle"}]},{path:"/settings/fileList",icon:"settings",name:"设置",menuCode:"settings",allShow:!1,children:[{name:"用户文件",path:"/settings/fileList"},{name:"用户管理",path:"/settings/userList"},{path:"/settings/sysSetting",name:"系统设置"}]}],f=m({}),F=m(),o=u=>{!u.path||u.menuCode==f.value.menuCode||x.push(u.path)},i=(u,$)=>{const I=_.find(L=>L.menuCode===u);f.value=I,F.value=$};ie(()=>P,(u,$)=>{u.meta.menuCode&&i(u.meta.menuCode,u.path)},{immediate:!0,deep:!0});const a=m(),b=()=>{a.value.show(r.value)},C=()=>{r.value=g.VueCookies.get("userInfo"),U.value=new Date().getTime()},s=m(),S=()=>{s.value.show()},A=()=>{g.Confirm("你确定要删除退出吗",async()=>{await g.Request({url:c.logout})&&(g.VueCookies.remove("userInfo"),x.push("/login"))})},h=m({useSpace:0,totalSpace:1}),M=async()=>{let u=await g.Request({url:c.getUseSpace,showLoading:!1});u&&(h.value=u.data)};return M(),(u,$)=>{const I=v("el-popover"),L=v("Avatar"),J=v("el-dropdown-item"),ae=v("el-dropdown-menu"),oe=v("el-dropdown"),le=v("el-progress"),ne=v("router-view");return l(),p("div",qe,[t("div",Le,[Be,t("div",Te,[n(I,{width:800,trigger:"click",visible:e.value,"onUpdate:visible":$[0]||($[0]=k=>e.value=k),offset:20,transition:"none","hide-after":0,"popper-style":{padding:"0px"}},{reference:d(()=>[je]),default:d(()=>[n(Me,{ref_key:"uploaderRef",ref:y,onUploadCallback:V},null,512)]),_:1},8,["visible"]),n(oe,null,{dropdown:d(()=>[n(ae,null,{default:d(()=>[n(J,{onClick:b},{default:d(()=>[E(" 修改头像 ")]),_:1}),n(J,{onClick:S},{default:d(()=>[E(" 修改密码 ")]),_:1}),n(J,{onClick:A},{default:d(()=>[E(" 退出 ")]),_:1})]),_:1})]),default:d(()=>[t("div",Ee,[t("div",Ge,[n(L,{userId:r.value.userId,avatar:r.value.avatar,timestamp:U.value,width:46},null,8,["userId","avatar","timestamp"])]),t("span",Oe,z(r.value.nickName),1)])]),_:1})])]),t("div",Je,[t("div",He,[t("div",Ke,[(l(),p(j,null,H(_,k=>(l(),p(j,null,[k.allShow||!k.allShow&&r.value.admin?(l(),p("div",{key:0,onClick:re=>o(k),class:T(["menu-item",k.menuCode==f.value.menuCode?"active":""])},[t("div",{class:T(["iconfont","icon-"+k.icon])},null,2),t("div",We,z(k.name),1)],10,Qe)):N("",!0)],64))),64))]),t("div",Xe,[(l(!0),p(j,null,H(f.value.children,k=>(l(),p("div",{onClick:re=>o(k),class:T(["menu-item-sub",F.value==k.path?"active":""])},[k.icon?(l(),p("span",{key:0,class:T(["iconfont","icon-"+k.icon])},null,2)):N("",!0),t("span",Ze,z(k.name),1)],10,Ye))),256)),f.value&&f.value.tips?(l(),p("div",et,z(f.value.tips),1)):N("",!0),t("div",tt,[st,t("div",at,[n(le,{percentage:Math.floor(h.value.useSpace/h.value.totalSpace*1e4)/100,color:"#409eff"},null,8,["percentage"])]),t("div",ot,[t("div",lt,z(O(g).Utils.size2Str(h.value.useSpace))+"/ "+z(O(g).Utils.size2Str(h.value.totalSpace)),1),t("div",{class:"iconfont icon-refresh",onClick:M})])])])]),t("div",nt,[n(ne,null,{default:d(({Component:k})=>[(l(),B(ue(k),{onAddFile:D,ref_key:"routerViewRef",ref:R,onReload:M},null,544))]),_:1})])]),n(we,{ref_key:"updateAvatarRef",ref:a,onUpdateAvatar:C},null,512),n(ke,{ref_key:"updatePasswordRef",ref:s},null,512)])}}},Mt=se(rt,[["__scopeId","data-v-4d6c57b6"]]);export{Mt as default};
